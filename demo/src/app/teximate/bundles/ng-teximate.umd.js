!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/operator/map"),require("rxjs/add/operator/do"),require("rxjs/add/operator/mergeAll"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/delay"),require("rxjs/add/operator/switchMap"),require("rxjs/add/observable/from"),require("rxjs/add/observable/of"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Observable","rxjs/Subject","rxjs/add/operator/map","rxjs/add/operator/do","rxjs/add/operator/mergeAll","rxjs/add/operator/mergeMap","rxjs/add/operator/delay","rxjs/add/operator/switchMap","rxjs/add/observable/from","rxjs/add/observable/of","@angular/common"],t):t(e.ngTeximate=e.ngTeximate||{},e.ng.core,e.Rx,e.Rx,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable,e.Rx.Observable,e.ng.common)}(this,function(e,t,r,n,o,a,i,s,l,d,u,p,c){"use strict";var f,m={SEQUENCE:"SEQUENCE",REVERSE:"REVERSE",SYNC:"SYNC",SHUFFLE:"SHUFFLE"};!function(e){e.shuffle=function(e){for(var t,r,n=e.length;n;)r=Math.floor(Math.random()*n--),t=e[n],e[n]=e[r],e[r]=t;return e},e.textFactory=function(e){var t=[];return e.split("\n").map(function(e,r){var n=[];e.split(" ").filter(function(e){return""!==e}).map(function(e,t){var r=[];e.split(/(?!$)/u).map(function(e,t){r.push({text:e,class:" letter"+(t+1),visibility:"hidden"})}),n.push({letters:r,class:" word"+(t+1),visibility:"hidden"})}),t.push({words:n,class:" line"+(r+1),visibility:"hidden"})}),t},e.processWord=function(e,t,r,n){var o,a;switch(e.word.type){case m.SYNC:o=r,a=0;break;case m.REVERSE:o=t.length-r-1,a=n*e.letter.delay+r*e.word.delay;break;default:o=r,a=n*e.letter.delay+r*e.word.delay}return{letters:t[o].letters,delay:a}},e.processLetter=function(e,t,r){var n,o;switch(e.letter.type){case m.SYNC:n=r,o=0;break;case m.REVERSE:n=t.length-r-1,o=r*e.letter.delay;break;default:n=r,o=r*e.letter.delay}return{item:t[n],delay:o}}}(f||(f={}));var b=function(){function e(){var e=this;this.arr=[],this.worker=new n.Subject,this.text=new n.Subject,this.worker.switchMap(function(t){return"word"===t.type?e.wordsJob(t.textArr,t.options):e.lettersJob(t.textArr,t.options)}).subscribe()}return e.prototype.run=function(e,t,r){this.arr=f.textFactory(e),this.worker.next({textArr:this.arr,options:t,type:r})},e.prototype.runEffect=function(e,t){this.worker.next({textArr:this.arr,options:e,type:t})},e.prototype.lettersJob=function(e,t){var n=this;return r.Observable.from(e).mergeMap(function(o){var a=0;return r.Observable.of(o.words).mergeAll().mergeMap(function(i,s){var l=f.processWord(t,o.words,s,a);a+=l.letters.length;var d;return d=t.letter.type===m.SHUFFLE?f.shuffle(l.letters.slice()):l.letters,r.Observable.of(d).delay(l.delay).mergeAll().mergeMap(function(o,a){var i=f.processLetter(t,d,a);return r.Observable.of(i.item).delay(i.delay).do(function(r){r.visibility="visible",r.animateClass=" animated "+t.animation.name,n.text.next(e)})})})})},e.prototype.wordsJob=function(e,t){var n=this;return r.Observable.from(e).mergeMap(function(o,a){return r.Observable.of(o.words).mergeAll().mergeMap(function(a,i){var s=f.processWord(t,o.words,i,0);return r.Observable.of(s).delay(s.delay).do(function(){a.visibility="visible",a.animateClass=" animated "+t.animation.name,n.text.next(e)})})})},e}();b.decorators=[{type:t.Injectable}],b.ctorParameters=function(){return[]};var y=function(){function e(e,t,r){this.teximate=e,this.renderer=t,this.jobText="Teximate is working",this.jobType="letter",this.jobEffect={animation:{name:"fadeIn",duration:300},word:{type:m.SEQUENCE,delay:100},letter:{type:m.SHUFFLE,delay:50}},this.style=this.renderer.createElement("style"),this.renderer.appendChild(r.nativeElement,this.style)}return e.prototype.ngOnChanges=function(e){var t=e.text&&e.text.firstChange;e.text&&e.text.currentValue&&(this.jobText=e.text.currentValue,t=!0),e.type&&e.type.currentValue&&(this.jobType=e.type.currentValue),e.effect&&(this.jobEffect=Object.assign({},this.jobEffect,e.effect.currentValue),this.setAnimationDuration(e.effect.currentValue.animation.duration)),t?this.teximate.run(this.jobText,this.jobEffect,this.jobType):this.teximate.runEffect(this.jobEffect,this.jobType)},e.prototype.runEffect=function(e,t){this.teximate.runEffect(e,t)},e.prototype.setAnimationDuration=function(e){this.renderer.setProperty(this.style,"innerHTML","\n      .animated {\n        animation-duration: "+e+"ms;\n        -webkit-animation-duration: "+e+"ms;\n        -moz-animation-duration: "+e+"ms;\n        -o-animation-duration: "+e+"ms;\n        -ms-animation-duration: "+e+"ms;\n      }\n    ")},e.prototype.ngOnDestroy=function(){this.teximate.text.unsubscribe(),this.teximate.worker.unsubscribe()},e}();y.decorators=[{type:t.Component,args:[{selector:"teximate",template:'\n    <span aria-label="text">\n\n      <div *ngFor="let line of teximate.text | async" [class]="\'line\' + line.class" [style.visibility]="line.visibility">\n\n        <span *ngFor="let word of line.words" [class]="\'word\' + word.class + word.animateClass" [style.visibility]="word.visibility">\n\n          <span *ngFor="let letter of word.letters" [class]="\'letter\' + letter.class + letter.animateClass"\n           [style.visibility]="letter.visibility">\n            {{letter.text}}\n          </span>\n\n        </span>\n      </div>\n\n    </span>\n  ',styles:["\n    .word, .letter{\n        display: inline-block;\n        //  fix for poor ios performance \n        transform: translate3d(0,0,0);\n        -moz-transform: translate3d(0,0,0);\n        -o-transform: translate3d(0,0,0);\n        -webkit-transform: translate3d(0,0,0);\n    }\n    .word{ \n        margin-right: 8px;\n    }\n  "],changeDetection:t.ChangeDetectionStrategy.OnPush,viewProviders:[b]}]}],y.ctorParameters=function(){return[{type:b},{type:t.Renderer2},{type:t.ElementRef}]},y.propDecorators={text:[{type:t.Input}],type:[{type:t.Input}],effect:[{type:t.Input}]};var x=function(){function e(){}return e}();x.decorators=[{type:t.NgModule,args:[{imports:[c.CommonModule],providers:[b],declarations:[y],exports:[y]}]}],x.ctorParameters=function(){return[]},e.TeximateModule=x,e.TeximateService=b,e.TeximateComponent=y,e.TeximateOrder=m,Object.defineProperty(e,"__esModule",{value:!0})});
